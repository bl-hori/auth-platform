spring:
  datasource:
    # Database connection is provided dynamically by Testcontainers via @DynamicPropertySource
    # in BaseIntegrationTest. No hardcoded values needed here.
    driver-class-name: org.postgresql.Driver

  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false

  flyway:
    enabled: true
    clean-disabled: false
    clean-on-validation-error: true
    baseline-on-migrate: true
    locations: classpath:db/migration

  # Disable Redis for tests
  data:
    redis:
      repositories:
        enabled: false

  # Disable cache for tests
  cache:
    type: none

# Test security configuration
authplatform:
  security:
    api-keys:
      enabled: true
      header-name: X-API-Key
      keys:
        test-api-key-12345: test-org-id
  rate-limit:
    enabled: false  # Disable rate limiting in tests by default
    capacity: 10
    refill-tokens: 10
    refill-period: 1m
  opa:
    url: http://localhost:8181
    timeout-ms: 100
  keycloak:
    enabled: true  # Enable JWT authentication for integration tests
    base-url: http://localhost:8180
    realm: authplatform
    issuer-uri: http://localhost:8180/realms/authplatform
    jwk-set-uri: http://localhost:8180/realms/authplatform/protocol/openid-connect/certs
    jwt:
      public-key-cache-ttl: 3600
      clock-skew-seconds: 30
      expected-audience: auth-platform-backend

# Disable actuator security for tests
management:
  endpoints:
    web:
      exposure:
        include: '*'
